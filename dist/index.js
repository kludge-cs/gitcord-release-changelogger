"use strict";var e=require("os"),t=require("fs"),n=require("path"),r=require("http"),s=require("https"),o=require("querystring"),a=require("url");function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var u=i(e),c=i(t),d=i(n),l=i(r),f=i(s),p=i(o),h=i(a),m="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function y(e){var t={exports:{}};return e(t,t.exports),t.exports}var g=Object.defineProperty({toCommandValue:function(e){return null==e?"":"string"==typeof e||e instanceof String?e:JSON.stringify(e)}},"__esModule",{value:!0});const v=(m&&m.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t})(u.default);function w(e,t,n){const r=new _(e,t,n);process.stdout.write(r.toString()+v.EOL)}var b=w;class _{constructor(e,t,n){e||(e="missing.command"),this.command=e,this.properties=t,this.message=n}toString(){let e="::"+this.command;if(this.properties&&Object.keys(this.properties).length>0){e+=" ";let n=!0;for(const r in this.properties)if(this.properties.hasOwnProperty(r)){const s=this.properties[r];s&&(n?n=!1:e+=",",e+=`${r}=${t=s,g.toCommandValue(t).replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A").replace(/:/g,"%3A").replace(/,/g,"%2C")}`)}}var t;return e+=`::${function(e){return g.toCommandValue(e).replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A")}(this.message)}`,e}}var C=Object.defineProperty({issueCommand:b,issue:function(e,t=""){w(e,{},t)}},"__esModule",{value:!0}),O=m&&m.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};const j=O(c.default),q=O(u.default);var E=Object.defineProperty({issueCommand:function(e,t){const n=process.env[`GITHUB_${e}`];if(!n)throw new Error(`Unable to find environment variable for file command ${e}`);if(!j.existsSync(n))throw new Error(`Missing file at path: ${n}`);j.appendFileSync(n,`${g.toCommandValue(t)}${q.EOL}`,{encoding:"utf8"})}},"__esModule",{value:!0}),$=y((function(e,t){var n=m&&m.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function i(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,i)}u((r=r.apply(e,t||[])).next())}))},r=m&&m.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const s=r(u.default),o=r(d.default);var a;function i(e){C.issue("error",e instanceof Error?e.toString():e)}function c(e){C.issue("group",e)}function l(){C.issue("endgroup")}!function(e){e[e.Success=0]="Success",e[e.Failure=1]="Failure"}(a=t.ExitCode||(t.ExitCode={})),t.exportVariable=function(e,t){const n=g.toCommandValue(t);if(process.env[e]=n,process.env.GITHUB_ENV){const t="_GitHubActionsFileCommandDelimeter_",r=`${e}<<${t}${s.EOL}${n}${s.EOL}${t}`;E.issueCommand("ENV",r)}else C.issueCommand("set-env",{name:e},n)},t.setSecret=function(e){C.issueCommand("add-mask",{},e)},t.addPath=function(e){process.env.GITHUB_PATH?E.issueCommand("PATH",e):C.issueCommand("add-path",{},e),process.env.PATH=`${e}${o.delimiter}${process.env.PATH}`},t.getInput=function(e,t){const n=process.env[`INPUT_${e.replace(/ /g,"_").toUpperCase()}`]||"";if(t&&t.required&&!n)throw new Error(`Input required and not supplied: ${e}`);return n.trim()},t.setOutput=function(e,t){C.issueCommand("set-output",{name:e},t)},t.setCommandEcho=function(e){C.issue("echo",e?"on":"off")},t.setFailed=function(e){process.exitCode=a.Failure,i(e)},t.isDebug=function(){return"1"===process.env.RUNNER_DEBUG},t.debug=function(e){C.issueCommand("debug",{},e)},t.error=i,t.warning=function(e){C.issue("warning",e instanceof Error?e.toString():e)},t.info=function(e){process.stdout.write(e+s.EOL)},t.startGroup=c,t.endGroup=l,t.group=function(e,t){return n(this,void 0,void 0,(function*(){let n;c(e);try{n=yield t()}finally{l()}return n}))},t.saveState=function(e,t){C.issueCommand("save-state",{name:e},t)},t.getState=function(e){return process.env[`STATE_${e}`]||""}})),P=y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.CentraResponse=void 0,t.CentraResponse=class{constructor(e){this.coreRes=e,this.body=Buffer.alloc(0),this.headers=e.headers,this.statusCode=e.statusCode}_addChunk(e){this.body=Buffer.concat([this.body,e])}json(){return JSON.parse(this.body)}text(){return this.body.toString("utf-8")}}})),S=y((function(e,t){var n=m&&m.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CentraRequest=void 0;const r=n(d.default),s=n(l.default),o=n(f.default),a=n(p.default);t.CentraRequest=class{constructor(e,t="GET"){return this.httpMethod=t,this.data=null,this.sendDataAs=null,this.reqHeaders={},this.coreOptions={},this.url="string"==typeof e?new h.default.URL(e):e,this}query(e,t){return"object"==typeof e?Object.keys(e).forEach((t=>{this.url.searchParams.append(t,e[t])})):this.url.searchParams.append(e,t),this}path(e){return this.url.pathname=r.default.join(this.url.pathname,e),this}body(e,t){return this.sendDataAs="object"!=typeof e||t||Buffer.isBuffer(e)?t?t.toLowerCase():"buffer":"json",this.data="form"===this.sendDataAs?a.default.stringify(e):"json"===this.sendDataAs?JSON.stringify(e):e,this}header(e,t){return"object"==typeof e?Object.keys(e).forEach((t=>{this.reqHeaders[t.toLowerCase()]=e[t]})):this.reqHeaders[e.toLowerCase()]=t,this}method(e){return this.httpMethod=e,this}timeout(e){return this.coreOptions.timeout=e,this}async json(){return(await this.send()).json()}async raw(){return(await this.send()).body}async text(){return(await this.send()).text()}send(){return new Promise(((e,t)=>{this.data&&(this.reqHeaders.hasOwnProperty("content-type")||("json"===this.sendDataAs?this.reqHeaders["content-type"]="application/json":"form"===this.sendDataAs&&(this.reqHeaders["content-type"]="application/x-www-form-urlencoded")),this.reqHeaders.hasOwnProperty("content-length")||(this.reqHeaders["content-length"]=Buffer.byteLength(this.data)));const n={protocol:this.url.protocol,host:this.url.hostname,port:this.url.port,path:this.url.pathname+this.url.search,method:this.httpMethod,headers:this.reqHeaders,...this.coreOptions};let r;const a=n=>{let r=n;const s=new P.CentraResponse(n);r.on("error",(e=>{t(e)})),r.on("data",(e=>{s._addChunk(e)})),r.on("end",(()=>{e(s)}))};if("http:"===this.url.protocol)r=s.default.request(n,a);else{if("https:"!==this.url.protocol)throw new Error(`Bad URL protocol: ${this.url.protocol}`);r=o.default.request(n,a)}r.on("error",(e=>{t(e)})),this.data&&r.write(this.data),r.end()}))}}}));(async function(){const e={avatar:$.getInput("avatar-url"),body:(t=$.getInput("release-body")||"# Meta\nThis release has no bundled changelog.",t.replace(/\r/g,"").replace(/\n\n/g,"\n").replace(/\n(-|\*) +([*a-zA-Z0-9])/g,"\n$2")),name:$.getInput("release-name"),username:$.getInput("username"),webhook:$.getInput("webhook-url")};var t;const n=function(e){let t;const n=[];return e.forEach((e=>{""!==e.value.replace(/\s/g,"")?n.push(e):t||(t=!0,n.push({name:"Meta",value:e.name}))})),n}(function(e){const t=[],n=/^#{1,6} (.+)/;for(const r of e.split("\n")){const e=n.exec(r);e?t.push({name:e[1],value:""}):t[t.length-1].value+=`\n${r}`}return t}(e.body));$.setOutput("fields",JSON.stringify(n));const r={username:e.username,avatar_url:e.avatar,embeds:[{title:e.name,fields:n}]};if($.setOutput("payload",JSON.stringify(r)),e.webhook){const t=await((e,t="GET")=>new S.CentraRequest(e,t))(`${e.webhook}?wait=true`,"POST").header({"Content-Type":"application/json"}).body(r).send(),n=t.text();$.setOutput("api-result",n),200!==t.statusCode&&$.setFailed(n)}})().catch((e=>$.setFailed(e)));
